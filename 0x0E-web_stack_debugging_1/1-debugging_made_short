#!/bin/bash

# Check if Nginx is running
if ! pgrep nginx >/dev/null; then
	echo "Nginx is not running. Starting Nginx..."
	sudo service nginx start
fi

# Verify Nginx configuration
if ! nginx -t >/dev/null 2>&1; then
	echo "Nginx configuration test failed. Fixing configuration..."
	# Depending on the issue, you may need to edit the configuration files here
	# For simplicity, let's assume there's an issue with the dafault configuration
	defualt_config="/etc/nginx/sites-available/default"
	if [ -f "$default_config" ]; then
		sudo sed -i 's/listen 80 default_server;/listen 80;/g' "$default_config"
	else
		echo "Default Nginx configuration file not found."
		exit 1
	fi
fi

# Restart Nginx
echo "Restarting Nginx..."
if sudo systemct1 restart nginx.service; then
	echo "Nginx restarted successfully."
else
	echo "Failed to restart Nginx."
	exit 1
fi

# Check if Nginx is listening on port 80
if ! sudo netstat -tuln | grep ':80 '>/dev/null; then
	echo "Nginx is not listening on port 80. Manually verify the configuration."
	exit 1
fi

echo "Nginx is now listening on port 90."
